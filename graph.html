<!DOCTYPE html>
<head>
    <title>Web Visualizer</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script
        src="d3.v3.min.js"
        charset="utf-8">
    </script>
    <script
        src="output.js"
        charset="utf-8">
    </script>
    <script>
        var toggle = 1;

        function neighbor(i) {
            var edges = dataset['edges'];
            var result = [];
            for (k = 0; k < edges.length; k++) {
                if (edges[k]['source'].index === i) {
                    result.push(edges[k]['target'].index);
                }
                else {
                    if (edges[k]['target'].index === i) {
                        result.push(edges[k]['source'].index);
                    }
                }
            }
            return result;
        }

        function loader() {
            var colors = d3.scale.category20();

            var dataset1 = [30, 30, 40];
            var pie = d3.layout.pie();

            var w = 1000;
            var h = 600;
            var outerRadius = 13;
            var innerRadius = 0;

            var svg = d3.select("#visualization")
                    .append("svg")
                    .attr("height", h)
                    .attr("width", w);

            var force = d3.layout.force()
                    .nodes(dataset.nodes)
                    .links(dataset.edges)
                    .size([w, h])
                    .linkDistance([50])
                    .charge(-500)
                    .start();

            var edges = svg.selectAll("line")
                    .data(dataset.edges)
                    .enter()
                    .append("line")
                    .style("stroke", "#ccc")
                    .style("stroke-width", 1);

            var nodes = svg.selectAll("g")
                    .data(dataset.nodes)
                    .enter()
                    .append("svg:g")
                    .call(force.drag);

            nodes.append("circle")
                    .attr("r", 10)
                    .style("fill", function (d, i) {
                        switch (d.sqli_errors.valueOf()) {
                            case 1:
                                return "yellow"
                                break;
                            case 2:
                                return "Orange";
                                break;
                            case 3:
                                return "#FF4500";
                                break;
                            default:
                                return "SteelBlue";
                        }
                    });

            nodes.append("svg:title")
                    .text(function (d) { return d.node.valueOf(); });


            force.on("tick", function () {
                edges.attr("x1", function (d) {
                    return d.source.x;
                })
                .attr("y1", function (d) {
                    return d.source.y;
                })
                .attr("x2", function (d) {
                    return d.target.x;
                })
                .attr("y2", function (d) {
                    return d.target.y;
                });

                nodes.attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")"; });

            });

            d3.select('#toggle').on("click", function (d, i) {
                console.log(toggle);
                nodes.selectAll("circle")
                   .transition().duration(500)
                   .style("fill", function (d, i) {
                       var n;
                       if (toggle == 1) {
                           n = d.xss_errors.valueOf();
                           d3.select("#toggle").text("XSS");
                       }
                       else {
                           n = d.sqli_errors.valueOf();
                           d3.select("#toggle").text("SQLI");
                       }
                       switch (n) {
                           case 1:
                               return "yellow"
                               break;
                           case 2:
                               return "Orange";
                               break;
                           case 3:
                               return "#FF4500";
                               break;
                           default:
                               return "SteelBlue";
                       }
                   })
                ;
                if (toggle == 1) {
                    toggle = 0
                }
                else {
                    toggle = 1;
                }
            });
        }

        window.onload = loader;
    </script>
</head>
<body>
    <div id="visualization">
    </div>
    <br />
    <a id="toggle" href="#">SQLI</a>
</body>
